<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deal Tracker</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="container">
    <h1>Deal Tracker</h1>
    <p>Scanning TCGplayer every 3 hours automatically. Use manual scan or add search options below.</p>
    <button id="manual-scan">Run Manual Scan</button>
    <h2>Search Options</h2>
    <ul id="options-list"></ul>
    <form id="add-option-form">
      <input type="text" id="new-option" placeholder="Enter product line (e.g., pokemon, yugioh)" required />
      <button type="submit">Add Option</button>
    </form>
    <p id="status"></p>
  </div>
  <script>
    async function fetchOptions() {
      const res = await fetch('/settings');
      const data = await res.json();
      const list = document.getElementById('options-list');
      list.innerHTML = '';
      data.searchOptions.forEach((opt) => {
        const li = document.createElement('li');
        li.textContent = opt;
        list.appendChild(li);
      });
    }
    document.getElementById('manual-scan').addEventListener('click', async () => {
      const status = document.getElementById('status');
      status.textContent = 'Running scan...';
      const res = await fetch('/manual-scan', { method: 'POST' });
      const data = await res.json();
      status.textContent = data.message;
    });
    document.getElementById('add-option-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const newOpt = document.getElementById('new-option').value.trim();
      if (!newOpt) return;
      await fetch('/settings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ newOption: newOpt }),
      });
      document.getElementById('new-option').value = '';
      await fetchOptions();
    });
    fetchOptions();
  </script>
</body>
</html>
